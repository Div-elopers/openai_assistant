steps:
  # Paso 1: Construcci√≥n de la imagen
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/alamo-utec/openai_assistant_flask', '.']
    
  # Paso 2: Push de la imagen al registro de contenedores
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/alamo-utec/openai_assistant_flask']
  
  # Paso 3: Llamada a la API de Cloud Build usando el secreto para el trigger
  - name: 'curlimages/curl'
    entrypoint: 'sh'
    args:
      - '-c'
      - |
        curl -X POST \
          -H "Authorization: Bearer $(gcloud auth print-access-token)" \
          "https://cloudbuild.googleapis.com/v1/projects/alamo-utec/locations/southamerica-east1/triggers/29e1c4f3-aa76-4fac-a697-ae21e5fef235:run"

images:
  - 'gcr.io/alamo-utec/openai_assistant_flask'

options:
  logging: CLOUD_LOGGING_ONLY
